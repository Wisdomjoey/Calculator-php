const hyphen = `
<svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 482 1036">
	<g>
		<path class="digit__path" d="m345.6 463.5h-209.9l-107.9 57.7 107.9 57.7h209.9l113.7-57.7z"/>
	</g>
</svg>
`;
const num0 = `
<svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 482 1036">
	<g>
		<path class="digit__path" d="m17 37l100.9 89.3v279.3l-100.9 97z"/>
		<path class="digit__path" d="m17 536.3l100.9 89.2v279.4l-100.9 97z"/>
		<path class="digit__path" d="m463.2 37l-100.9 89.3v279.3l100.9 97z"/>
		<path class="digit__path" d="m25.7 17.6l107.7 100.9h209.5l113.5-100.9z"/>
		<path class="digit__path" d="m25.7 1018.7l107.7-100.9h209.5l113.5 100.9z"/>
		<path class="digit__path" d="m463.2 536.3l-100.9 89.2v279.4l100.9 97z"/>
	</g>
</svg>
`;
const num1 = `
<svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 482 1036">
	<g>
		<path class="digit__path" d="m17 16.8v63.8 224 94.9 102.3l105.1-101.1v-291z"/>
		<path class="digit__path" d="m17 1021.9v-66.6-224-94.9-99.6l105.1 93v291z"/>
	</g>
</svg>
`;
const num2 = `
<svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 482 1036">
	<g>
		<path class="digit__path" d="m16 537l100.9 89.2v279.3l-100.9 97z"/>
		<path class="digit__path" d="m462.1 37.8l-100.8 89.3v279.3l100.8 96.9z"/>
		<path class="digit__path" d="m24.7 18.4l107.7 100.9h209.5l113.4-100.9z"/>
		<path class="digit__path" d="m24.7 1019.3l107.7-100.9h209.5l113.4 100.9z"/>
		<path class="digit__path" d="m348.6 462.9h-209.4l-107.7 57.6 107.7 57.6h209.4l113.5-57.6z"/>
	</g>
</svg>
`;
const num3 = `
<svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 482 1036">
	<g>
		<path class="digit__path" d="m459.3 37.5l-101.1 89.5v279.8l101.1 97.2z"/>
		<path class="digit__path" d="m21 18.1l107.9 101.1h209.9l113.7-101.1z"/>
		<path class="digit__path" d="m21 1021l107.9-101.1h209.9l113.7 101.1z"/>
		<path class="digit__path" d="m459.3 537.7l-101.1 89.4v279.9l101.1 97.2z"/>
		<path class="digit__path" d="m345.6 463.5h-209.9l-107.9 57.7 107.9 57.7h209.9l113.7-57.7z"/>
	</g>
</svg>
`;
const num4 = `
<svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 482 1036">
	<g>
		<path class="digit__path" d="m17 35l100.9 89.3v279.3l-100.9 97.1z"/>
		<path class="digit__path" d="m463.3 35l-100.9 89.3v279.3l100.9 97.1z"/>
		<path class="digit__path" d="m463.3 534.3l-100.9 89.2v279.4l100.9 97z"/>
		<path class="digit__path" d="m349.7 460.2h-209.5l-107.7 57.6 107.7 57.7h209.5l113.5-57.7h0.1z"/>
	</g>
</svg>
`;
const num5 = `
<svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 482 1036">
	<g>
		<path class="digit__path" d="m16 35.5l101.3 89.6v280.6l-101.3 97.4z"/>
		<path class="digit__path" d="m24.8 16l108.1 101.3h210.4l114-101.3z"/>
		<path class="digit__path" d="m24.8 1021.3l108.1-101.3h210.4l114 101.3z"/>
		<path class="digit__path" d="m464.1 536.9l-101.3 89.6v280.5l101.3 97.4z"/>
		<path class="digit__path" d="m350.1 462.5h-210.4l-108.1 57.8 108.1 57.9h210.4l114-57.9z"/>
	</g>
</svg>
`;
const num6 = `
<svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 482 1036">
	<g>
		<path class="digit__path" d="m16 38.4l100.7 89.1v278.9l-100.7 96.8z"/>
		<path class="digit__path" d="m16 536.8l100.7 89.1v278.9l-100.7 96.9z"/>
		<path class="digit__path" d="m24.7 19l107.5 100.7h209.2l113.3-100.7z"/>
		<path class="digit__path" d="m24.7 1018.4l107.5-100.7h209.2l113.3 100.7z"/>
		<path class="digit__path" d="m461.5 536.8l-100.7 89.1v278.9l100.7 96.9z"/>
		<path class="digit__path" d="m348.2 462.9h-209.2l-107.5 57.5 107.5 57.5h209.2l113.3-57.5z"/>
	</g>
</svg>
`;
const num7 = `
<svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 482 1036">
	<g>
		<path class="digit__path" d="m462.7 38.3l-102.6 90.7v284l102.6 98.6z"/>
		<path class="digit__path" d="m18 18.6l109.4 102.6h213l115.4-102.6z"/>
		<path class="digit__path" d="m462.7 545.8l-102.6 90.7v283.9l102.6 98.6z"/>
	</g>
</svg>
`;
const num8 = `
<svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 482 1036">
	<g>
		<g>
			<path class="digit__path" d="m17 38.4l100.8 89.1v279.1l-100.8 96.9z"/>
			<path class="digit__path" d="m17 537.1l100.8 89.2v279l-100.8 96.9z"/>
			<path class="digit__path" d="m462.7 38.4l-100.7 89.1v279.1l100.7 96.9z"/>
			<path class="digit__path" d="m25.7 19l107.6 100.8h209.3l113.4-100.8z"/>
			<path class="digit__path" d="m25.7 1019l107.6-100.8h209.3l113.4 100.8z"/>
			<path class="digit__path" d="m462.7 537.1l-100.7 89.2v279l100.7 96.9z"/>
		</g>
		<path class="digit__path" d="m349.4 463.1h-209.3l-107.6 57.6 107.6 57.5h209.3l113.3-57.5z"/>
	</g>
</svg>
`;
const num9 = `
<svg version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 482 1036">
	<g>
		<path class="digit__path" d="m17 38.8l100.8 89.2v279.2l-100.8 97z"/>
		<path class="digit__path" d="m463 38.8l-100.8 89.2v279.2l100.8 97z"/>
		<path class="digit__path" d="m25.7 19.4l107.7 100.8h209.4l113.4-100.8z"/>
		<path class="digit__path" d="m25.7 1020l107.7-100.8h209.4l113.4 100.8z"/>
		<path class="digit__path" d="m463 537.8l-100.8 89.2v279.2l100.8 97z"/>
		<path class="digit__path" d="m349.6 463.8h-209.5l-107.6 57.5 107.6 57.6h209.5l113.4-57.6z"/>
	</g>
</svg>
`;

let displayValue = "";
let typedValue = "";
let resultValue = "";

const displayDigit = () => {
	const digitCons = document.querySelectorAll(".digit__con");
	const data = resultValue.length > 0 ? resultValue : displayValue;
	const digitLength = data.length;
	const length = digitCons.length;
	const reversed = data
		.split("")
		.reverse()
		.slice(0, digitLength > length ? length : digitLength);

	for (let i = 0; i < length; i++) {
		const ele = digitCons[i];
		const char = reversed[i] ?? "";

		ele.classList.remove("dot");

		if (ele.children.length > 1) {
			ele.children[1].remove();
		}

		switch (char) {
			case ".":
				ele.classList.add("dot");
				break;
			case "-":
				ele.innerHTML += hyphen;
				break;
			case "0":
				ele.innerHTML += num0;
				break;
			case "1":
				ele.innerHTML += num1;
				break;
			case "2":
				ele.innerHTML += num2;
				break;
			case "3":
				ele.innerHTML += num3;
				break;
			case "4":
				ele.innerHTML += num4;
				break;
			case "5":
				ele.innerHTML += num5;
				break;
			case "6":
				ele.innerHTML += num6;
				break;
			case "7":
				ele.innerHTML += num7;
				break;
			case "8":
				ele.innerHTML += num8;
				break;
			case "9":
				ele.innerHTML += num9;
				break;

			default:
				break;
		}
	}
};

const displayCalc = () => {
	formatDisplay();

	const ele = document.querySelector(".top__display");
	const length = typedValue.length;
	const width = Math.floor(ele.scrollWidth);

	if (length * 11.54 > width) ele.style = `--d-width: ${width / length}px;`;

	ele.innerHTML = typedValue
		.split("")
		.map((val) => `<p>${val}</p>`)
		.join("");
};

const clearDisplay = () => {
	const top = document.querySelector(".top__display");
	const cons = document.querySelectorAll(".digit__con");

	displayValue = "";
	top.innerHTML = "";

	cons.forEach((ele) => {
		ele.classList.remove("dot");
		ele.children.length > 1 ? ele.children[1].remove() : null;
	});
};

const formatDisplay = () => {
	typedValue = typedValue.replace(/\âœ•/g, "*");
};

const calcFormat = () => {
	const typedLength = typedValue.length;
	let count = 0;

	for (let i = 0; i < typedLength; i++) {
		if (typedValue[i] === "(") count++;
		if (typedValue[i] === ")") count--;
	}

	const newStr = `${typedValue}${new Array(count).fill(")").join("")}`;
	console.log(newStr);
	const formatted = newStr
		.replace(/%(\d+)/g, "/100*$1")
		.replace(/(?<=\d)%/g, "/100")
		.replace(/(?<=\d)\(/g, "*(")
		.replace(/\)(\d+)/g, ")*$1");

	return formatted;
};

const calcExpression = () => {
	formatDisplay();

	const formatted = calcFormat();
	const result = new Function(`return ${formatted}`);

	// console.log(typedValue);
	// console.log(displayValue);
	// console.log(formatted);
	// console.log(result());

	resultValue = `${result()}`;

	displayDigit();
};

const handleClick = (char) => {
	if (resultValue.length > 0) {
		resultValue = "";
		typedValue = "";

		clearDisplay();
	}

	if (isNaN(parseInt(char))) {
		const displayLength = displayValue.length;
		let typedLength = typedValue.length;
		let lastChar = typedValue[typedLength - 1];

		switch (char) {
			case "c":
				typedValue = "";

				clearDisplay();
				break;
			case "d":
				if (displayLength > 0) {
					displayValue = displayValue.slice(0, displayLength - 1);

					displayDigit();
				} else if (typedLength > 0) {
					typedValue = typedValue.slice(0, typedLength - 1);

					displayCalc();
				}
				break;
			case ".":
				if (!displayValue.includes(".")) {
					displayValue += displayLength > 0 ? "." : "0.";

					displayDigit();
				}
				break;
			case "%":
				if (displayLength > 0) {
					typedValue += `${displayValue}%`;

					clearDisplay();
				} else if (lastChar !== "%" && isNaN(parseInt(lastChar))) {
					typedValue = typedValue.slice(0, -1) + "%";
				}

				displayCalc();
				break;
			case "b":
				if (typedLength > 0) {
					typedValue += displayValue;
					typedLength = typedValue.length;
					lastChar = typedValue[typedLength - 1];
					let count = 0;

					for (let i = 0; i < typedLength; i++) {
						if (typedValue[i] === "(") count++;
						if (typedValue[i] === ")") count--;
					}

					typedValue +=
						!!count && !isNaN(parseInt(lastChar))
							? new Array(count).fill(")").join("")
							: "(";

					if (displayLength > 0) clearDisplay();
				} else if (displayLength > 0) {
					typedValue += `${displayValue}(`;

					clearDisplay();
				} else {
					typedValue += "(";
				}

				displayCalc();
				break;
			case "/":
				typedValue += displayValue;
				typedLength = typedValue.length;
				lastChar = typedValue[typedLength - 1];

				if (
					lastChar === "%" ||
					lastChar === ")" ||
					!isNaN(parseInt(lastChar))
				) {
					typedValue += "/";
				} else if (typedLength > 0) {
					typedValue = typedValue.slice(0, -1) + "/";
				}

				if (displayLength > 0) clearDisplay();

				displayCalc();
				break;
			case "*":
				typedValue += displayValue;
				typedLength = typedValue.length;
				lastChar = typedValue[typedLength - 1];

				if (
					lastChar === "%" ||
					lastChar === ")" ||
					!isNaN(parseInt(lastChar))
				) {
					typedValue += "*";
				} else if (typedLength > 0) {
					typedValue = typedValue.slice(0, -1) + "*";
				}

				if (displayLength > 0) clearDisplay();

				displayCalc();
				break;
			case "-":
				typedValue += displayValue;
				typedLength = typedValue.length;
				lastChar = typedValue[typedLength - 1];

				if (
					lastChar === "%" ||
					lastChar === ")" ||
					typedLength <= 0 ||
					!isNaN(parseInt(lastChar))
				) {
					typedValue += "-";
				} else if (typedLength > 0) {
					typedValue = typedValue.slice(0, -1) + "-";
				}

				if (displayLength > 0) clearDisplay();

				displayCalc();
				break;
			case "+":
				typedValue += displayValue;
				typedLength = typedValue.length;
				lastChar = typedValue[typedLength - 1];

				if (
					lastChar === "%" ||
					lastChar === ")" ||
					typedLength <= 0 ||
					!isNaN(parseInt(lastChar))
				) {
					typedValue += "+";
				} else if (typedLength > 0) {
					typedValue = typedValue.slice(0, -1) + "+";
				}

				if (displayLength > 0) clearDisplay();

				displayCalc();
				break;
			case "=":
				if (typedLength > 0) {
					typedValue += displayValue;
					typedLength = typedValue.length;

					clearDisplay();
					displayCalc();
					calcExpression();
				}
				break;

			default:
				break;
		}
	} else {
		if (char === "0" && displayValue.length <= 0) return;

		displayValue += char;

		displayDigit();
	}
};

const cons = document.querySelectorAll(".button__con");

cons.forEach((ele) =>
	ele.addEventListener("mousedown", () => ele.classList.add("tap"))
);
cons.forEach((ele) =>
	ele.addEventListener("mouseup", () => ele.classList.remove("tap"))
);
